<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒé‡Œé©¬é€ç¦ - é©¬å¹´è´ºå²</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&family=ZCOOL+XiaoWei&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body,
        html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: linear-gradient(180deg, #FFF8DC 0%, #F5DEB3 50%, #D2B48C 100%);
            font-family: "Noto Serif SC", serif;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(180deg,
                    rgba(255, 248, 220, 0.9) 0%,
                    rgba(245, 222, 179, 0.8) 40%,
                    rgba(238, 232, 170, 0.9) 70%,
                    rgba(210, 180, 140, 0.8) 100%);
            overflow: hidden;
            box-shadow: inset 0 0 100px rgba(139, 69, 19, 0.1);
            transition: background 0.5s;
        }

        #game-container.fever-mode {
            background: linear-gradient(45deg, #FF0000, #B22222, #FFD700);
            background-size: 400% 400%;
            animation: feverBackground 2s ease infinite;
        }

        @keyframes feverBackground {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        #fever-bar-container {
            position: absolute;
            bottom: 110px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 8px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 105;
        }

        #fever-bar-fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FF6347);
            border-radius: 5px;
            transition: width 0.3s;
        }

        #game-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://www.transparenttextures.com/patterns/handmade-paper.png');
            opacity: 0.2;
            pointer-events: none;
            z-index: 1;
        }

        canvas {
            display: block;
            width: 100%;
            height: 100%;
            z-index: 2;
            position: relative;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 10;
        }

        #hud {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 10;
            pointer-events: none;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.7));
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #B22222;
            box-shadow: 0 4px 15px rgba(178, 34, 34, 0.3);
            backdrop-filter: blur(10px);
        }

        #score-display {
            font-size: 32px;
            color: #8B0000;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            font-family: "Ma Shan Zheng", cursive;
        }

        #combo-display {
            font-size: 24px;
            color: #DAA520;
            margin-top: 5px;
            animation: pulse 0.5s ease-in-out;
        }

        #timer {
            font-size: 28px;
            color: #B22222;
            font-weight: bold;
            font-family: "Ma Shan Zheng", cursive;
        }

        .seal {
            position: absolute;
            bottom: 30px;
            left: 30px;
            width: 70px;
            height: 70px;
            border: 3px solid #B22222;
            color: #B22222;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: "Ma Shan Zheng", cursive;
            font-size: 24px;
            line-height: 1.2;
            text-align: center;
            padding: 5px;
            background: radial-gradient(circle, rgba(178, 34, 34, 0.15), rgba(178, 34, 34, 0.05));
            transform: rotate(-8deg);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        #start-screen,
        #end-screen {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.98), rgba(255, 248, 220, 0.95));
            padding: 50px;
            border: 5px double #B22222;
            border-radius: 20px;
            text-align: center;
            pointer-events: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.8);
            max-width: 500px;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        h1 {
            color: #B22222;
            font-size: 48px;
            margin-bottom: 20px;
            font-family: "Ma Shan Zheng", cursive;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.1);
            background: linear-gradient(45deg, #B22222, #8B0000);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            color: #B22222;
            font-size: 32px;
            margin-bottom: 15px;
            font-family: "Ma Shan Zheng", cursive;
        }

        p {
            color: #555;
            font-size: 18px;
            line-height: 1.6;
            margin: 15px 0;
        }

        .highlight {
            color: #DAA520;
            font-weight: bold;
            font-size: 24px;
        }

        button {
            background: linear-gradient(135deg, #B22222, #8B0000);
            color: #FFD700;
            border: none;
            padding: 15px 40px;
            font-size: 22px;
            cursor: pointer;
            margin-top: 25px;
            font-family: "Ma Shan Zheng", cursive;
            border-radius: 30px;
            box-shadow: 0 6px 0 #5C0000, 0 8px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.15s;
            position: relative;
            overflow: hidden;
        }

        button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        button:hover::before {
            width: 300px;
            height: 300px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 0 #5C0000, 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        button:active {
            transform: translateY(3px);
            box-shadow: 0 3px 0 #5C0000, 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .cloud {
            position: absolute;
            border-radius: 50%;
            filter: blur(40px);
            z-index: 0;
            animation: moveClouds var(--speed) linear infinite;
            opacity: 0.6;
        }

        @keyframes moveClouds {
            from {
                left: -300px;
                opacity: 0;
            }

            10% {
                opacity: 0.6;
            }

            90% {
                opacity: 0.6;
            }

            to {
                left: 110%;
                opacity: 0;
            }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 5;
            animation: particleFade 1s ease-out forwards;
        }

        @keyframes particleFade {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }

            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }

        #instructions {
            margin-top: 20px;
            padding: 20px;
            background: rgba(218, 165, 32, 0.1);
            border-radius: 10px;
            border: 1px dashed #DAA520;
        }

        .instruction-item {
            margin: 8px 0;
            color: #666;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <div class="seal">é©¬å¹´<br>å¤§å‰</div>
        <div id="fever-bar-container">
            <div id="fever-bar-fill"></div>
        </div>

        <div id="hud">
            <div class="stat-box">
                <div id="score-display">ç¦: 0</div>
                <div id="combo-display" style="display:none;">è¿å‡» x<span id="combo-num">0</span></div>
            </div>
            <div class="stat-box">
                <div id="timer">30s</div>
            </div>
        </div>

        <div id="ui-overlay">
            <div id="start-screen">
                <h1>åƒé‡Œé©¬é€ç¦</h1>
                <p>ç§»åŠ¨é¼ æ ‡æˆ–è§¦æ‘¸å±å¹•ï¼Œé©¾é©­ç¥éª<br>æ”¶é›†å¤©é™ç¥¥ç‘ï¼Œç¥ˆç¦çº³ç¥¥</p>
                <div id="instructions">
                    <div class="instruction-item">ğŸ”¥ ç§¯æ”’èƒ½é‡ï¼Œå¼€å¯ã€å¤©é©¬ä¸‹å‡¡ã€‘ç‹‚æš´æ¨¡å¼</div>
                    <div class="instruction-item">ğŸ§² ç¥¥ç‘è‡ªå¸¦ç£åŠ›ï¼Œç¦»é©¬è¿‘ç‚¹å®ƒä¼šé£å‘ä½ ï¼</div>
                    <div class="instruction-item">â­ é‡‘è‰²ç¦å­—ã€é«˜è¿å‡»å¯å¤§å¹…æ‹‰å‡è¯„ä»·</div>
                </div>
                <button id="start-btn">å¯ç¨‹çº³ç¦</button>
            </div>
            <div id="end-screen" style="display: none;">
                <h2 id="final-greeting">é©¬è¸é£ç‡•ï¼Œç¦æ»¡äººé—´ï¼</h2>
                <p>æ€»ç¦æ°”å€¼: <span class="highlight" id="final-score">0</span></p>
                <p>æœ€é«˜è¿å‡»: <span class="highlight" id="max-combo">0</span></p>
                <p id="rank-text"></p>
                <button id="restart-btn">å†æˆ˜ä¸€å›</button>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score-display');
        const comboDisplay = document.getElementById('combo-display');
        const comboNum = document.getElementById('combo-num');
        const timerDisplay = document.getElementById('timer');
        const startScreen = document.getElementById('start-screen');
        const endScreen = document.getElementById('end-screen');
        const finalScore = document.getElementById('final-score');
        const maxComboDisplay = document.getElementById('max-combo');
        const rankText = document.getElementById('rank-text');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');

        let score = 0;
        let combo = 0;
        let maxCombo = 0;
        let comboTimer = null;
        let gameActive = false;
        let gameTime = 30;
        let items = [];
        let particles = [];
        let lastSpawn = 0;
        let achievements = [];
        let screenShake = 0;
        let fever = 0;
        let feverMode = false;
        let feverTimer = null;

        const horse = {
            x: 0,
            y: 0,
            targetX: 0,
            width: 90,
            height: 90,
            symbol: 'ğŸ',
            rotation: 0
        };

        const blessings = ['ç¦', 'å‰', 'ç¥¥', 'ä¸°', 'ä¹', 'ç¦§', 'åº·', 'é¡º', 'å®‰', 'å®'];
        const colors = ['#B22222', '#8B0000', '#DAA520', '#CD7F32', '#A0522D', '#DC143C'];

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            // åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæé«˜é©¬çš„ä½ç½®ï¼Œé¿å…è¢«åº•éƒ¨é®æŒ¡
            const isMobile = window.innerWidth < 768;
            horse.y = canvas.height - (isMobile ? 200 : 150);
            horse.x = canvas.width / 2 - horse.width / 2;
            horse.targetX = horse.x;
        }

        function createClouds() {
            const container = document.getElementById('game-container');
            const existingClouds = container.querySelectorAll('.cloud');
            existingClouds.forEach(cloud => cloud.remove());

            for (let i = 0; i < 12; i++) {
                const cloud = document.createElement('div');
                cloud.className = 'cloud';
                const size = 200 + Math.random() * 400;
                cloud.style.width = size + 'px';
                cloud.style.height = size * 0.6 + 'px';
                cloud.style.top = (Math.random() * 90) + '%';
                cloud.style.background = `radial-gradient(circle, 
                    rgba(${139 + Math.random() * 50}, ${69 + Math.random() * 30}, 19, 0.08), 
                    transparent)`;
                cloud.style.setProperty('--speed', (25 + Math.random() * 50) + 's');
                cloud.style.animationDelay = (Math.random() * 25) + 's';
                container.appendChild(cloud);
            }
        }

        const updateMouse = (x) => {
            if (!gameActive) return;
            horse.targetX = x - horse.width / 2;
            if (horse.targetX < 0) horse.targetX = 0;
            if (horse.targetX > canvas.width - horse.width) {
                horse.targetX = canvas.width - horse.width;
            }
        };

        window.addEventListener('mousemove', (e) => updateMouse(e.clientX));
        window.addEventListener('touchmove', (e) => {
            updateMouse(e.touches[0].clientX);
            e.preventDefault();
        }, { passive: false });

        function spawnItem(timestamp) {
            if (!gameActive) return;

            const baseRate = feverMode ? 100 : 800;
            const spawnInterval = Math.max(feverMode ? 50 : 300, baseRate - score * 8);
            if (timestamp - lastSpawn < spawnInterval) return;
            lastSpawn = timestamp;

            const isGolden = feverMode || Math.random() < 0.15; // All golden in fever mode
            const item = {
                x: Math.random() * (canvas.width - 60),
                y: -80,
                speed: 3.5 + Math.random() * 3.5 + (score / 15),
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * 8,
                symbol: blessings[Math.floor(Math.random() * blessings.length)],
                color: isGolden ? '#FFD700' : colors[Math.floor(Math.random() * colors.length)],
                size: 40 + Math.random() * 25,
                golden: isGolden,
                opacity: 1,
                wobble: Math.random() * Math.PI * 2
            };
            items.push(item);
        }

        function createParticles(x, y, color, count = 8) {
            for (let i = 0; i < count; i++) {
                const angle = (Math.PI * 2 * i) / count;
                const particle = {
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * (2 + Math.random() * 3),
                    vy: Math.sin(angle) * (2 + Math.random() * 3) - 2,
                    size: 3 + Math.random() * 5,
                    color: color,
                    life: 1,
                    decay: 0.02 + Math.random() * 0.02
                };
                particles.push(particle);
            }
        }

        function createFirework(x, y) {
            const colors = ['#FFD700', '#FF6347', '#FF69B4', '#00CED1', '#FF8C00'];
            for (let i = 0; i < 30; i++) {
                const angle = (Math.PI * 2 * i) / 30;
                const speed = 3 + Math.random() * 4;
                const particle = {
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    size: 4 + Math.random() * 4,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    life: 1,
                    decay: 0.015
                };
                particles.push(particle);
            }
        }

        function showComboText(comboCount) {
            const container = document.getElementById('game-container');
            const comboFlash = document.createElement('div');
            comboFlash.className = 'combo-flash';

            let text = '';
            if (comboCount >= 20) text = 'ç¥ä¹å…¶æŠ€ï¼';
            else if (comboCount >= 15) text = 'æ‰€å‘æŠ«é¡ï¼';
            else if (comboCount >= 10) text = 'åŠ¿å¦‚ç ´ç«¹ï¼';
            else if (comboCount >= 5) text = 'è¿å‡»ï¼';

            comboFlash.textContent = text;
            container.appendChild(comboFlash);

            setTimeout(() => comboFlash.remove(), 1000);
        }

        function triggerScreenShake() {
            screenShake = 10;
            const container = document.getElementById('game-container');
            container.classList.add('shake');
            setTimeout(() => container.classList.remove('shake'), 500);
        }

        function activateFeverMode() {
            if (feverMode) return;
            feverMode = true;
            document.getElementById('game-container').classList.add('fever-mode');
            showComboText('FEVER TIME!');
            triggerScreenShake();

            // Fever power: horse speed increases, spawn rate explodes
            const originalY = horse.y;

            feverTimer = setTimeout(() => {
                feverMode = false;
                fever = 0;
                document.getElementById('fever-bar-fill').style.width = '0%';
                document.getElementById('game-container').classList.remove('fever-mode');
            }, 5000); // 5 seconds of madness
        }

        function updateCombo() {
            combo++;
            if (combo > maxCombo) maxCombo = combo;

            // Fever system
            if (!feverMode) {
                fever = Math.min(100, fever + 5);
                document.getElementById('fever-bar-fill').style.width = fever + '%';
                if (fever >= 100) activateFeverMode();
            }

            if (combo > 1) {
                comboDisplay.style.display = 'block';
                comboNum.textContent = combo;
                comboDisplay.style.animation = 'none';
                setTimeout(() => comboDisplay.style.animation = 'pulse 0.3s ease-in-out', 10);
            }

            // ç‰¹æ®Šè¿å‡»æ•ˆæœ
            if (combo === 5) {
                showComboText(5);
            } else if (combo === 10) {
                showComboText(10);
                createFirework(canvas.width / 2, canvas.height / 2);
            } else if (combo === 15) {
                showComboText(15);
                triggerScreenShake();
                createFirework(canvas.width / 3, canvas.height / 3);
                createFirework(canvas.width * 2 / 3, canvas.height / 3);
            } else if (combo >= 20 && combo % 5 === 0) {
                showComboText(combo);
                triggerScreenShake();
                for (let i = 0; i < 3; i++) {
                    createFirework(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height / 2
                    );
                }
            }

            clearTimeout(comboTimer);
            comboTimer = setTimeout(() => {
                combo = 0;
                comboDisplay.style.display = 'none';
            }, 1500);
        }

        function update(timestamp) {
            if (!gameActive) return;

            const dx = horse.targetX - horse.x;
            horse.x += dx * 0.15;
            horse.rotation = dx * 0.05;

            // Spawn items
            spawnItem(timestamp);

            // Update items
            for (let i = items.length - 1; i >= 0; i--) {
                const item = items[i];
                item.y += item.speed;
                item.rotation += item.rotationSpeed;
                item.wobble += 0.1;
                item.x += Math.sin(item.wobble) * 0.5;

                // Collision detection with improved hitbox
                const itemCenterX = item.x + item.size / 2;
                const itemCenterY = item.y + item.size / 2;
                const horseCenterX = horse.x + horse.width / 2;
                const horseCenterY = horse.y + horse.height / 2;

                const distance = Math.sqrt(
                    Math.pow(itemCenterX - horseCenterX, 2) +
                    Math.pow(itemCenterY - horseCenterY, 2)
                );

                // ç¥¥ç‘ç£é“æ•ˆæœï¼šå½“è·ç¦»è¾ƒè¿‘æˆ–å¤„äºç‹‚æš´æ¨¡å¼æ—¶ï¼Œç‰©å“ä¼šè¢«é©¬â€œå¸â€è¿‡å»
                // è¿™æ ·åœ¨é«˜é€Ÿä¸‹ç©å®¶æ›´æœ‰â€œæŒæ§æ„Ÿâ€
                if (distance < 250) {
                    const pullStrength = feverMode ? 0.2 : 0.08;
                    item.x += (horseCenterX - itemCenterX) * pullStrength;
                }

                // åŠ¨æ€åˆ¤å®šåŒºï¼šé€Ÿåº¦è¶Šå¿«ï¼Œåˆ¤å®šèŒƒå›´ç¨å¾®æ‰©å¤§ï¼Œè¡¥å¿ååº”æ—¶é—´
                const hitBoxBonus = Math.max(0, (item.speed - 5) * 3);
                const threshold = (item.size + horse.width) / 2.5 + hitBoxBonus;

                if (distance < threshold) {
                    const points = item.golden ? 2 : 1;
                    const bonusPoints = Math.floor(combo / 3);
                    score += points + bonusPoints;

                    scoreDisplay.textContent = `ç¦: ${score}`;
                    updateCombo();
                    createParticles(itemCenterX, itemCenterY, item.color, item.golden ? 12 : 8);
                    items.splice(i, 1);
                    continue;
                }

                if (item.y > canvas.height) {
                    items.splice(i, 1);
                }
            }

            // Update particles
            for (let i = particles.length - 1; i >= 0; i--) {
                const p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.15; // gravity
                p.life -= p.decay;

                if (p.life <= 0) {
                    particles.splice(i, 1);
                }
            }

            draw();
            requestAnimationFrame(update);
        }

        function draw() {
            // Clear canvas first
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Apply screen shake
            ctx.save();
            if (screenShake > 0) {
                ctx.translate(
                    (Math.random() - 0.5) * screenShake,
                    (Math.random() - 0.5) * screenShake
                );
                screenShake *= 0.9;
            }

            // Gradient background
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, 'rgba(255, 248, 220, 0.3)');
            gradient.addColorStop(0.5, 'rgba(245, 222, 179, 0.2)');
            gradient.addColorStop(1, 'rgba(210, 180, 140, 0.3)');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;

            // Draw items with effects
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            items.forEach(item => {
                ctx.save();
                ctx.translate(item.x + item.size / 2, item.y + item.size / 2);
                ctx.rotate((item.rotation * Math.PI) / 180);

                ctx.font = `bold ${item.size}px "Noto Serif SC", serif`;

                // Glow effect for golden items
                if (item.golden) {
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = '#FFD700';
                }

                // å…ˆç»˜åˆ¶æè¾¹
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.lineWidth = 4;
                ctx.strokeText(item.symbol, 0, 0);

                // å†ç»˜åˆ¶å¡«å……
                ctx.shadowBlur = 0;
                ctx.fillStyle = item.color;
                ctx.fillText(item.symbol, 0, 0);

                ctx.restore();
            });

            // Draw horse
            ctx.save();
            ctx.translate(horse.x + horse.width / 2, horse.y + horse.height / 2);
            ctx.rotate(horse.rotation * (feverMode ? 0.3 : 0.1));

            if (feverMode) {
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#FFD700';
                // Add extreme tilt on move
                horse.width = 110;
                horse.height = 110;
            } else {
                horse.width = 90;
                horse.height = 90;
            }

            ctx.font = `${horse.width}px serif`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(horse.symbol, 0, 0);
            ctx.restore();

            ctx.restore(); // Restore screen shake
        }

        function startGame() {
            score = 0;
            combo = 0;
            maxCombo = 0;
            fever = 0;
            feverMode = false;
            document.getElementById('fever-bar-fill').style.width = '0%';
            document.getElementById('game-container').classList.remove('fever-mode');
            gameTime = 30;
            items = [];
            particles = [];
            lastSpawn = 0;
            gameActive = true;

            scoreDisplay.textContent = 'ç¦: 0';
            comboDisplay.style.display = 'none';
            timerDisplay.textContent = '30s';
            startScreen.style.display = 'none';
            endScreen.style.display = 'none';

            resize();
            createClouds();

            const timerInterval = setInterval(() => {
                if (!gameActive) {
                    clearInterval(timerInterval);
                    return;
                }
                gameTime--;
                timerDisplay.textContent = gameTime + 's';

                if (gameTime <= 5) {
                    timerDisplay.style.color = '#DC143C';
                    timerDisplay.style.animation = 'pulse 0.5s ease-in-out infinite';
                } else {
                    timerDisplay.style.color = '#B22222';
                    timerDisplay.style.animation = 'none';
                }

                if (gameTime <= 0) {
                    endGame();
                    clearInterval(timerInterval);
                }
            }, 1000);

            requestAnimationFrame(update);
        }

        function endGame() {
            gameActive = false;
            endScreen.style.display = 'block';
            finalScore.textContent = score;
            maxComboDisplay.textContent = maxCombo;

            let rank = '';
            let greeting = '';
            if (score >= 100) {
                rank = 'ğŸ† ç¥éªå¤©é™';
                greeting = 'é©¬è¸é£ç‡•ï¼Œç¦è¿äº¨é€šï¼';
            } else if (score >= 70) {
                rank = 'ğŸŒŸ åƒé‡Œè¿½é£';
                greeting = 'ä¸€é©¬å½“å…ˆï¼Œå‰ç¥¥å¦‚æ„ï¼';
            } else if (score >= 50) {
                rank = 'â­ éªé©¬å¥”è…¾';
                greeting = 'é©¬åˆ°æˆåŠŸï¼Œå–œæ°”æ´‹æ´‹ï¼';
            } else if (score >= 30) {
                rank = 'âœ¨ è‰¯é©¹å¯æœŸ';
                greeting = 'ç¦æ˜Ÿé«˜ç…§ï¼Œæ­¥æ­¥é«˜å‡ï¼';
            } else {
                rank = 'ğŸ¯ åˆéœ²é”‹èŠ’';
                greeting = 'ç»§ç»­åŠªåŠ›ï¼Œå¿…æœ‰æ‰€æˆï¼';
            }

            rankText.innerHTML = `<strong style="font-size: 20px; color: #DAA520;">${rank}</strong><br><span style="color: #666;">${greeting}</span>`;
            document.getElementById('final-greeting').textContent = greeting;
        }

        startBtn.addEventListener('click', startGame);
        restartBtn.addEventListener('click', startGame);
        window.addEventListener('resize', () => {
            if (!gameActive) resize();
        });

        createClouds();
        resize();
    </script>

</body>

</html>